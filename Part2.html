<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2022.3">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
    span.Apple-tab-span {white-space:pre}
  </style>
</head>
<body>
<p class="p1">Clayton Cohn</p>
<p class="p1">23 April 2021</p>
<p class="p2"><br></p>
<p class="p1">Part2: SQL Queries</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">I am going to do the best I can to explain my logic in the problems below (I haven’t used SQL since I was an undergraduate, but I have no doubt that I will pick it right back up if given the opportunity).</p>
<p class="p2"><br></p>
<p class="p1">1. How many users completed an exercise in their first month per monthly cohort?</p>
<p class="p2"><br></p>
<p class="p1">SELECT COUNT(user_id), MONTH(created_date)</p>
<p class="p1">FROM users</p>
<p class="p1">WHERE user_id IN<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-tab-span">	</span>(SELECT user_id,</p>
<p class="p1"><span class="Apple-tab-span">	</span>FROM exercises</p>
<p class="p1"><span class="Apple-tab-span">	</span>WHERE MONTH(exercise_completion_date) = MONTH(users.creation_date)</p>
<p class="p1"><span class="Apple-tab-span">	</span>GROUP BY user_id)</p>
<p class="p1">GROUP BY MONTH(created_date);</p>
<p class="p2"><br></p>
<p class="p1">My logic was to first group the exercises by user, then take the MIN date (first exercise) of each user.<span class="Apple-converted-space"> </span></p>
<p class="p1">I then wanted to return a list of users whose creation_dates were in the same month as their MIN exercise_completion_dates.</p>
<p class="p1">Grouping by creation_date, I would return the counts of users in each creation month who also had the same MIN exercise_completion_dates months.</p>
<p class="p1">I am not sure if I can compare two columns in different tables without a JOIN, so I would have to look more into this as well.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">2. How many users completed a given amount of exercises?</p>
<p class="p2"><br></p>
<p class="p1">SELECT<span class="Apple-converted-space">  </span>COUNT(exercises.exercise_completion_date), COUNT(users.user_id)</p>
<p class="p1">FROM users</p>
<p class="p1">INNER JOIN exercises</p>
<p class="p1">ON users.user_id = exercises.user_id</p>
<p class="p1">GROUP BY user_id;</p>
<p class="p2"><br></p>
<p class="p1">For this one, my logic was to first join the table on user_id, then group by user_id and count the number of exercises for each user.</p>
<p class="p1">After that, I wanted to return a list of the number of exercise completions with the corresponding number of users who completed that many exercises.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">3. Which organizations have the most severe patient population?</p>
<p class="p2"><br></p>
<p class="p1">SELECT TOP 5 Providers.organization_id</p>
<p class="p1">FROM Providers</p>
<p class="p1">INNER JOIN Phq9</p>
<p class="p1">ON Providers.provider_id = Phq9.provider_id</p>
<p class="p1">WHERE COUNT(Phq9.scores &gt;= 20)</p>
<p class="p1">GROUP BY organization_id</p>
<p class="p1">ORDER BY COUNT(Phq9.scores &gt;= 20) DESCENDING;</p>
<p class="p2"><br></p>
<p class="p1">For this one, I first wanted to join the tables on provider_id.</p>
<p class="p1">Next, I wanted to group by organization_id.</p>
<p class="p1">After they were grouped, I wanted each organization’s count of how the number scores greater than or equal to 20.</p>
<p class="p1">I then ordered the results by the number of scores greater than 20 in descending order, and returned the top 5 organization_ids.</p>
</body>
</html>
